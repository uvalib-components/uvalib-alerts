<!--
@license
Copyright (c) 2015 The Polymer Project Authors. All rights reserved.
This code may only be used under the BSD style license found at http://polymer.github.io/LICENSE.txt
The complete set of authors may be found at http://polymer.github.io/AUTHORS.txt
The complete set of contributors may be found at http://polymer.github.io/CONTRIBUTORS.txt
Code distributed by Google as part of the polymer project is also
subject to an additional IP rights grant found at http://polymer.github.io/PATENTS.txt
-->

<link rel="import" href="../polymer/polymer.html">
<link rel="import" href="../iron-icon/iron-icon.html">
<link rel="import" href="../iron-localstorage/iron-localstorage.html">
<link rel="import" href="../neon-animation/neon-animation-runner-behavior.html">
<link rel="import" href="../paper-button/paper-button.html">
<link rel="import" href="../paper-icon-button/paper-icon-button.html">
<link rel="import" href="../paper-dialog-behavior/paper-dialog-behavior.html">
<link rel="import" href="../paper-dialog-behavior/paper-dialog-shared-styles.html">
<link rel="import" href="../uvalib-theme/uvalib-icons.html">
<link rel="import" href="../uvalib-theme/uvalib-theme.html">
<link rel="import" href="uvalib-alerts-behavior.html">

<!--

`<uvalib-alert-dialog>` is a dialog with Material Design styling and optional animations when it is
opened or closed. It provides styles for a header, content area, and an action area for buttons.
You can use the `<paper-dialog-scrollable>` element (in its own repository) if you need a scrolling
content area. To autofocus a specific child element after opening the dialog, give it the `autofocus`
attribute. See `Polymer.PaperDialogBehavior` and `Polymer.IronOverlayBehavior` for specifics.

For example, the following code implements a dialog with a header, scrolling content area and
buttons. Focus will be given to the `dialog-confirm` button when the dialog is opened.

    <uvalib-alert-dialog>
      <h2>Header</h2>
      <paper-dialog-scrollable>
        Lorem ipsum...
      </paper-dialog-scrollable>
      <div class="buttons">
        <paper-button dialog-dismiss>Cancel</paper-button>
        <paper-button dialog-confirm autofocus>Accept</paper-button>
      </div>
    </uvalib-alert-dialog>

### Styling

See the docs for `Polymer.PaperDialogBehavior` for the custom properties available for styling
this element.

### Animations

Set the `entry-animation` and/or `exit-animation` attributes to add an animation when the dialog
is opened or closed. See the documentation in
[PolymerElements/neon-animation](https://github.com/PolymerElements/neon-animation) for more info.

For example:

    <link rel="import" href="components/neon-animation/animations/scale-up-animation.html">
    <link rel="import" href="components/neon-animation/animations/fade-out-animation.html">

    <uvalib-alert-dialog entry-animation="scale-up-animation"
                  exit-animation="fade-out-animation">
      <h2>Header</h2>
      <div>Dialog body</div>
    </uvalib-alert-dialog>

### Accessibility

See the docs for `Polymer.PaperDialogBehavior` for accessibility features implemented by this
element.

@group UVaLib Elements
@element uvalib-alert-dialog
@hero hero.svg
@demo demo/dialog.html
-->

<dom-module id="uvalib-alert-dialog">
  <template>
    <style include="paper-dialog-shared-styles uvalib-theme">
      iron-icon {
        --iron-icon-height: 15px;
        --iron-icon-width: 15px;
        color: #2979ff;
        margin-right: 6px;
        margin-bottom: 3px;
      }
      h2 {
        padding: 0;
        margin-top: 10px;
        margin-left: 15px;
        margin-right: 15px;
        margin-bottom: 0;
        font-family: var(--font-primary);
        font-size: 18px;
        font-weight: 500;
        font-style: normal;
        font-stretch: normal;
        line-height: 1.33;
        letter-spacing: normal;
        text-align: left;
        color: #084be0;
      }
      h3 {
        padding: 0;
        margin-left: 15px;
        margin-top: 10px;
        margin-bottom: 0;
        font-family: var(--font-primary);
        font-size: 16px;
        font-weight: 500;
        font-style: normal;
        font-stretch: normal;
        line-height: 1.5;
        letter-spacing: normal;
        text-align: left;
        color: rgba(0, 0, 0, 0.54);
      }
      .buttons {
        background-color: #eeeeee;
      }
      .body {
        padding: 0;
        margin-left: 15px;
        margin-top: 10px
        margin-bottom: 0;
        font-family: var(--font-primary);
        font-size: 14px;
        font-weight: normal;
        font-style: normal;
        font-stretch: normal;
        line-height: 1.43;
        letter-spacing: normal;
        text-align: left;
        color: rgba(0, 0, 0, 0.87);
      }
    </style>
    <h2><iron-icon icon="{{_getIcon(_selectedAlert)}}"></iron-icon>{{_getType(_selectedAlert)}}</h2>
    <h3 hidden$="{{!_selectedAlert.title}}">{{_selectedAlert.title}}</h3>
    <div class="body" inner-h-t-m-l="{{_selectedAlert.body}}"></div>
    <div class="buttons">
      <paper-icon-button icon="chevron-left" hidden$="{{!_isPrevious(_selected)}}" on-tap="_previous"></paper-icon-button>
      <paper-icon-button icon="chevron-right" hidden$="{{!_isNext(_selected)}}" on-tap="_next"></paper-icon-button>
      <paper-button hidden$="{{!href}}"><a href="{{href}}">More Info</a></paper-button>
      <paper-button dialog-dismiss>Dismiss</paper-button>
    </div>
  </template>
</dom-module>

<script>

(function() {

  Polymer({

    is: 'uvalib-alert-dialog',

    behaviors: [
      Polymer.PaperDialogBehavior,
      Polymer.NeonAnimationRunnerBehavior,
      uvalibbehaviors.alerts
    ],

    properties: {
      _selected: {
        type: Number,
        value: 0
      },
      _selectedAlert: {
        type: Object,
        computed: '_getCurrentAlert(_selected)'
      }
    },

    listeners: {
      'neon-animation-finish': '_onNeonAnimationFinish'
    },

    _next: function(){
      if (this._selected < this.alerts.length)
        this._selected++;
    },
    _previous: function(){
      if (this._selected > 0)
        this._selected--;
    },
    _isNext: function(selected) {
      return (this.alerts && this.alerts.length > selected+1);
    },
    _isPrevious: function(selected) {
      return (this.alerts && selected > 0);
    },

    _getIcon: function(alert) {
      return (alert && alert.icon)? alert.icon: this.icon;
    },
    _getType: function(alert) {
      return (alert && alert.type)? alert.type: this.type;
    },

    _getCurrentAlert: function(selected) {
      if (this.alerts && this.alerts.length >= selected)
        return this.alerts[selected];
      else
        return null;
    },

    _renderOpened: function() {
      this.cancelAnimation();
      this.playAnimation('entry');
    },

    _renderClosed: function() {
      this.cancelAnimation();
      this.playAnimation('exit');
    },

    _onNeonAnimationFinish: function() {
      if (this.opened) {
        this._finishRenderOpened();
      } else {
        this._finishRenderClosed();
      }
    }

  });

})();

</script>
